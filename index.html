<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <title>Kryptex</title>
  <style>
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: radial-gradient(ellipse at 50% 40%, #4e3620 0%, #2b1a0d 100%);
      background-attachment: fixed;
    }
    h1 {
      margin-top: 30px;
      font-size: 2.4em;
      color: #e2c17d;
      text-shadow: 0 2px 10px #2b1a0d, 0 0 20px #0009;
    }
    .clues {
      background: #4e3620e0;
      border: 1.5px solid #bba753;
      border-radius: 10px;
      padding: 18px 28px 12px 28px;
      margin-bottom: 10px;
      margin-top: 12px;
      width: 420px;
      max-width: 99vw;
      box-shadow: 0 2px 10px #bba75344;
      color: #e2c17d;
      font-family: 'IM Fell English', serif;
      text-shadow: 0 1px 8px #2b1a0d, 0 0 1px #000a;
    }
    .clues h2 {
      font-size: 1.2em;
      margin-top: 0;
      margin-bottom: 10px;
      font-family: 'Segoe UI', sans-serif;
      color: #e2c17d;
      letter-spacing: 1px;
      text-shadow: 0 1px 8px #2b1a0d, 0 0 1px #000a;
    }
    .clues ul {
      padding-left: 15px;
      margin: 0;
    }
    .clues li {
      margin-bottom: 13px;
      line-height: 1.4;
    }
    .kryptex-outer {
      display: flex;
      align-items: center;
      margin: 38px 0 17px 0;
      background: none;
    }
    .kryptex-endcap {
      width: 36px;
      height: 120px;
      background: linear-gradient(135deg, #b2a163 0%, #6d5a21 100%);
      border-radius: 14px 40px 40px 14px/60px 60px 60px 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 0;
      box-shadow: 0 2px 14px #a58b3a66;
      border: 2px solid #8c7b3f;
      font-size: 2.5em;
      color: #6d5a21;
      font-weight: bold;
      user-select: none;
    }
    .kryptex-endcap.right {
      transform: scaleX(-1);
      border-radius: 40px 14px 14px 40px/60px 60px 60px 60px;
    }
    .kryptex-rings {
      display: flex;
      gap: 0;
      background: #d2bd7f;
      border-radius: 18px;
      box-shadow: 0 4px 32px #7c6e2d66, 0 0 0 6px #ad9954, 0 0 0 12px #cfc39155;
      border: 2px solid #bba753;
      padding: 24px 8px;
    }
    .kryptex-ring {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0 2px;
      background: linear-gradient(135deg, #f7e9b5 20%, #bba753 80%);
      border: 2px solid #8c7b3f;
      border-radius: 8px;
      box-shadow: 0 2px 12px #6d5a2155;
      width: 44px;
      height: 110px;
      padding: 2px 0;
      position: relative;
      z-index: 1;
    }
    .kryptex-letter {
      font-size: 2.1em;
      font-family: 'Courier New', Courier, monospace;
      color: #4c3e1f;
      background: #fdf6c1;
      border-radius: 4px;
      margin: 14px 0;
      width: 90%;
      text-align: center;
      box-shadow: 0 2px 6px #fff2, 0 0 0 1px #bba753;
      border: 1px solid #8c7b3f66;
      font-weight: bold;
      letter-spacing: 2px;
      user-select: none;
      transition: background 0.15s, color 0.2s;
    }
    .arrow-btn {
      background: linear-gradient(90deg, #bba753 0%, #fdf6c1 100%);
      border: 1px solid #8c7b3f;
      border-radius: 6px;
      color: #4c3e1f;
      font-size: 1.1em;
      font-weight: bold;
      width: 28px;
      height: 24px;
      cursor: pointer;
      margin: 2px 0;
      box-shadow: 0 1px 2px #2223;
      transition: background 0.1s;
    }
    .arrow-btn:active {
      background: #f7e9b5;
    }
    .open-btn {
      padding: 14px 45px;
      font-size: 1.3em;
      background: linear-gradient(90deg, #f7e9b5 0%, #bba753 100%);
      color: #6d5a21;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      margin-bottom: 10px;
      box-shadow: 0 2px 12px #bba75355;
      letter-spacing: 2px;
      transition: background 0.2s;
      border: 2px solid #bba753;
    }
    .open-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      filter: grayscale(1);
    }
    .open-btn:hover:not(:disabled) {
      background: linear-gradient(90deg, #fff6c6 0%, #e8d387 100%);
    }
    #resultat {
      margin-top: 10px;
      font-size: 1.2em;
      color: #e2c17d;
      min-height: 2.2em;
      font-family: 'Segoe UI', monospace;
      text-shadow: 0 1px 10px #2b1a0d, 0 0 5px #0007;
    }
    .attempts {
      margin: 16px 0 0 0;
      min-height: 90px;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .attempt-row {
      display: flex;
      gap: 5px;
      margin-bottom: 6px;
    }
    .attempt-letter {
      width: 44px;
      height: 48px;
      border-radius: 6px;
      font-size: 2em;
      font-family: 'Courier New', Courier, monospace;
      font-weight: bold;
      text-align: center;
      line-height: 48px;
      background: #2b1a0d;
      color: #e2c17d;
      border: 1.5px solid #8c7b3f;
      box-shadow: 0 2px 8px #000c;
      transition: background 0.2s, color 0.2s;
    }
    .attempt-letter.green {
      background: #3ca366;
      color: #fff;
      border-color: #1e6941;
    }
    .attempt-letter.yellow {
      background: #d9d9d9;
      color: #2b1a0d;
      border-color: #bba753;
    }
    .attempt-letter.gray {
      background: #393939;
      color: #c8c8c8;
      border-color: #222;
    }
    .secret-scroll {
      margin: 30px auto 0;
      width: 390px;
      max-width: 95vw;
      background: #f0e5c0;
      border: 2px solid #bba753;
      border-radius: 12px;
      box-shadow: 0 4px 22px #a58b3a55;
      padding: 20px 28px;
      color: #6d5a21;
      font-family: 'IM Fell English', serif;
      font-size: 1.14em;
      display: none;
      animation: scroll-in 1s;
      white-space: pre-line;
    }
    .broken-msg {
      color: #e46b42;
      text-align: center;
      font-size: 1.2em;
      margin-top: 30px;
      background: #2b1a0d;
      border: 2px solid #e46b42;
      border-radius: 8px;
      padding: 16px 24px;
      box-shadow: 0 3px 20px #000b;
      font-family: 'IM Fell English', serif;
      max-width: 420px;
    }
    @keyframes scroll-in {
      from { opacity: 0; transform: scaleY(0.3) translateY(50px);}
      to { opacity: 1; transform: scaleY(1) translateY(0);}
    }
  </style>
</head>
<body>
  <h1>Kryptex</h1>
  <div class="clues">
    <h2>Ledetr√•de</h2>
    <ul>
      <li>üó∫Ô∏è <b>Kaptajnens Kahyt:</b>  
        <i>‚ÄúHun hviskede mit navn, men jeg glemte det, s√• snart jeg s√• hendes √∏jne. Alt hvad der blev tilbage‚Ä¶ var fornemmelsen af noget jeg burde have husket.‚Äù</i>
      </li>
      <li>üêö <b>Et spejl i bes√¶tningskvarteret:</b>  
        <i>‚ÄúDe ser dig ikke. Men dine b√•nd f√∏lger med i spejlet.‚Äù</i>
      </li>
      <li>üì¶ <b>En glemt kiste i lastrummet:</b>  
        <i>‚ÄúSkyggens gave: at du husker, det andre √∏nsker glemt.‚Äù</i>
      </li>
      <li>üìú <b>S√∏mands sang p√• sejlkl√¶de:</b>  
        <i>‚ÄúHvad havet har glemt, gemmer hun i m√∏rket.<br>
        Hvad vi har svigtet, venter i stilheden.<br>
        Et navn? Nej. Et b√•nd.<br>
        Et minde? M√•ske. En‚Ä¶‚Äù<br>
        <b>(‚Äì Resten af strofen er fl√•et v√¶k, men der st√•r kun √©t ord i hj√∏rnet: ‚ÄúERINDR‚Ä¶‚Äù)</b></i>
      </li>
    </ul>
  </div>
  <div class="kryptex-outer">
    <span class="kryptex-endcap">‚óÄ</span>
    <div class="kryptex-rings" id="rings"></div>
    <span class="kryptex-endcap right">‚ñ∂</span>
  </div>
  <button class="open-btn" id="openBtn" onclick="checkCode()" autofocus>√Öbn Kryptex</button>
  <div id="resultat"></div>
  <div class="attempts" id="attempts"></div>
  <div class="secret-scroll" id="scroll">
<b>Til Calius Vendren</b>

Vi sejlede i stilhed ‚Äì ikke for at undg√• stormen, men for at finde det, vi havde glemt.

Jeg troede ritualet d√∏de med hende...
Men hun vogter stadig. I spejle, i skygger, i hvisken p√• havet.

En af os har brudt l√∏ftet.
En anden har m√•ske husket det.

Maskerne er blevet fundet.
Blodet blev givet.
Og vandet ‚Äì det bev√¶gede sig.

Hvis du l√¶ser dette, s√• er du t√¶t p√•.
T√¶ttere end du tror.

Hun ser dig.
Glem det ikke.

‚Äì M
  </div>
  <div class="broken-msg" id="brokenMsg" style="display:none;">
    Kryptexen kn√¶kker med en metallisk lyd.<br>
    Ingen vej tilbage ‚Äì hemmeligheden g√•r tabt i m√∏rket.<br>
    <span style="font-size:1.2em;">üóùÔ∏è</span>
  </div>
  <script>
    // --- SETTINGS ---
    const solution = "ERINDRING";
    const wordLength = solution.length;
    const maxAttempts = 3;
    const bogstaver = "ABCDEFGHIJKLMNOPQRSTUVWXYZ√Ü√ò√Ö";
    let ringState = Array(wordLength).fill(0);
    let attempts = [];
    let locked = false;

    // --- Build rings ---
    const ringContainer = document.getElementById("rings");
    for (let i = 0; i < wordLength; i++) {
      const ring = document.createElement("div");
      ring.className = "kryptex-ring";
      ring.tabIndex = 0;
      ring.setAttribute('data-ring', i);

      const upBtn = document.createElement("button");
      upBtn.className = "arrow-btn";
      upBtn.innerHTML = "‚ñ≤";
      upBtn.onclick = () => turnRing(i, 1);

      const letter = document.createElement("div");
      letter.className = "kryptex-letter";
      letter.innerText = bogstaver[0];

      const downBtn = document.createElement("button");
      downBtn.className = "arrow-btn";
      downBtn.innerHTML = "‚ñº";
      downBtn.onclick = () => turnRing(i, -1);

      ring.appendChild(upBtn);
      ring.appendChild(letter);
      ring.appendChild(downBtn);

      ringContainer.appendChild(ring);

      // Keyboard support
      ring.addEventListener('focus', () => ring.classList.add("active"));
      ring.addEventListener('blur', () => ring.classList.remove("active"));
      ring.addEventListener('keydown', e => {
        if (e.key === "ArrowUp") { turnRing(i, 1); e.preventDefault(); }
        else if (e.key === "ArrowDown") { turnRing(i, -1); e.preventDefault(); }
      });
    }

    function turnRing(idx, dir) {
      if (locked) return;
      ringState[idx] = (ringState[idx] + dir + bogstaver.length) % bogstaver.length;
      updateRing(idx);
    }
    function updateRing(idx) {
      const ring = ringContainer.children[idx];
      ring.querySelector('.kryptex-letter').innerText = bogstaver[ringState[idx]];
    }
    function getGuess() {
      return ringState.map(idx => bogstaver[idx]).join('');
    }

    function checkCode() {
      if (locked) return;
      const valgt = getGuess();
      const resultat = document.getElementById("resultat");
      const scroll = document.getElementById("scroll");
      const attemptsDiv = document.getElementById("attempts");
      const brokenMsg = document.getElementById("brokenMsg");
      const openBtn = document.getElementById("openBtn");

      if (valgt.length !== wordLength) return;

      // Feedback-farver
      const feedback = Array(wordLength).fill("gray");
      const solutionArr = solution.split('');
      const guessArr = valgt.split('');
      // F√∏rste pas: gr√∏n for rigtige
      let used = Array(wordLength).fill(false);
      for (let i = 0; i < wordLength; i++) {
        if (guessArr[i] === solutionArr[i]) {
          feedback[i] = "green";
          used[i] = true;
        }
      }
      // Andet pas: hvid for forkert placering men findes
      for (let i = 0; i < wordLength; i++) {
        if (feedback[i] === "gray") {
          for (let j = 0; j < wordLength; j++) {
            if (!used[j] && guessArr[i] === solutionArr[j]) {
              feedback[i] = "yellow";
              used[j] = true;
              break;
            }
          }
        }
      }

      attempts.push({guess: valgt, feedback: feedback});
      renderAttempts();

      if (valgt === solution) {
        resultat.innerHTML = "üîì Kryptex √•bnet! En gammel pergamentrulle ruller ud...";
        scroll.style.display = 'block';
        locked = true;
        openBtn.disabled = true;
      } else if (attempts.length >= maxAttempts) {
        resultat.innerHTML = "";
        scroll.style.display = 'none';
        brokenMsg.style.display = 'block';
        locked = true;
        openBtn.disabled = true;
      } else {
        resultat.innerHTML = "‚ùå Forkert kode. Pr√∏v igen! ("+(maxAttempts-attempts.length)+" fors√∏g tilbage)";
        scroll.style.display = 'none';
      }
    }

    function renderAttempts() {
      const attemptsDiv = document.getElementById("attempts");
      attemptsDiv.innerHTML = "";
      for (let att of attempts) {
        const row = document.createElement("div");
        row.className = "attempt-row";
        for (let i = 0; i < att.guess.length; i++) {
          const letterDiv = document.createElement("div");
          letterDiv.className = "attempt-letter " + att.feedback[i];
          letterDiv.innerText = att.guess[i];
          row.appendChild(letterDiv);
        }
        attemptsDiv.appendChild(row);
      }
    }
  </script>
</body>
</html>
